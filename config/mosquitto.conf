# =================================================================
# Mosquitto Configuration for Fast C++ Server
# =================================================================

# --- 1. 监听端口 ---
# 监听标准 MQTT 端口，绑定到所有 IP (0.0.0.0)
listener 1883
protocol mqtt

# 监听 WebSocket 端口 (如果你的前端网页需要直接连 MQTT，可以解开下面两行)
# listener 9001
# protocol websockets

# --- 2. 权限控制 ---
# 允许匿名访问 (开发/内网环境方便)。
# 如果生产环境需要安全，改为 false 并配置 password_file
allow_anonymous true

# 密码文件路径 (若 allow_anonymous false，需用 mosquitto_passwd 生成此文件)
# password_file /etc/fast_cpp_server/pwfile

# 访问控制列表 (ACL) 文件
# acl_file /etc/fast_cpp_server/aclfile

# --- 3. 持久化 (Persistence) ---
# 启用持久化，重启后保留未送达的消息和订阅关系
persistence true

# 持久化数据库文件名
persistence_file mosquitto.db

# 持久化文件存放目录 (必须保证 mosquitto 运行用户有写权限)
# 建议放在 /var/lib/mosquitto/ 或者你程序的数据目录
persistence_location /var/lib/mosquitto/

# 多少秒自动保存一次内存数据到磁盘
autosave_interval 1800

# --- 4. 日志 (Logging) ---
# 将日志输出到文件
log_dest file /var/fast_cpp_server/logs/mosquitto.log

# 记录的日志级别
log_type error
log_type warning
log_type notice
log_type information
# log_type debug  # 调试时可开启

# --- 5. 性能调优 ---
# 允许的最大排队消息数 (防止内存爆炸)
max_queued_messages 1000

# 允许的最大并发连接数 (-1 表示不限制)
max_connections -1

# 消息体大小限制 (默认是 250MB，这里设为 20MB)
max_packet_size 20971520